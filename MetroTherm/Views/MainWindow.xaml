<Window x:Class="MetroTherm.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="EnergiKonvertering - Varmemester"
        Height="720" Width="1000"
        WindowStartupLocation="CenterScreen">



    <Grid>
        <!-- Hovedlayout: 
             Row 0 = Topbar
             Row 1 = Indhold (venstre filter + hovedindhold) -->
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <!-- Topbar -->
            <RowDefinition Height="*"/>
            <!-- Resten -->
        </Grid.RowDefinitions>

        <!-- TOPBAR -->
        <DockPanel Grid.Row="0" Background="#2D3E50" LastChildFill="True">
            <!-- Logo / tekst til venstre -->
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" Margin="10,0">
                <Image Source="/Metrotherm Logoos.png"
       Height="40"
       Margin="0,0,10,0" />
                <TextBlock Text="EnergiKonvertering"
                           VerticalAlignment="Center"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="White"/>
                <TextBlock Text="  – Varmemester"
                           VerticalAlignment="Center"
                           FontSize="16"
                           Foreground="LightGray"/>
            </StackPanel>

            <!-- Simpel “menu” til højre (kun visuelt, ikke nødvendigvis funktionel endnu) -->
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" Margin="0,0,20,0"/>
        </DockPanel>

        <!-- HOVEDINDHOLD: Venstre filter + TabControl -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <!-- Venstre panel -->
                <ColumnDefinition Width="*"/>
                <!-- Hovedindhold -->
            </Grid.ColumnDefinitions>

            <!-- VENSTRE FILTERPANEL -->
            <Border Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="0,0,1,0" Background="#F5F5F5">
                <StackPanel Margin="10">

                    <TextBlock Text="Filtre" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>

                    <!-- Periode-filter -->
                    <GroupBox Header="Periode" Margin="0,0,0,10">
                        <StackPanel Margin="5" IsEnabled="False">
                            <TextBlock Text="Fra dato:"/>
                            <DatePicker x:Name="FromDatePicker" Margin="0,0,0,5"/>
                            <TextBlock Text="Til dato:"/>
                            <DatePicker x:Name="ToDatePicker"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Ejendom / bygning -->

                    <!-- Søgning -->
                    <GroupBox Header="Søgning" Margin="0,0,0,10">
                        <StackPanel Margin="5">
                            <TextBlock Text="Søg (kunde, udstyr...)" Margin="0,0,0,5" IsEnabled="False"/>
                            <TextBox x:Name="SearchTextBox" IsEnabled="False" />
                            <Button Content="Søg" Margin="0,10,0,0" IsEnabled="False" />
                        </StackPanel>
                    </GroupBox>

                </StackPanel>
            </Border>

            <!-- HOVEDOMRÅDE MED FANER -->
            <TabControl Grid.Column="1" Margin="10">
                <!-- DASHBOARD -->
                <TabItem Header="Dashboard">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="82*"/>
                            <ColumnDefinition Width="83*"/>
                            <ColumnDefinition Width="99*"/>
                            <ColumnDefinition Width="431*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Dashboard" 
                                   FontSize="20" FontWeight="Bold" Margin="0,0,0,10" Grid.ColumnSpan="4"/>

                        <!-- Her kan du senere placere kort/overblik -->
                        <UniformGrid Grid.Row="1" Rows="1" Columns="3" Margin="0,10,0,0" Grid.ColumnSpan="4">
                            <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="5" Padding="10">
                                <StackPanel>
                                    <TextBlock Text="Seneste aflæsninger" FontWeight="Bold"/>
                                    <TextBlock Text="(liste / summering ...)" FontStyle="Italic"/>
                                </StackPanel>
                            </Border>
                            <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="5" Padding="10">
                                <StackPanel>
                                    <TextBlock Text="Månedens forbrug/omsætning" FontWeight="Bold"/>
                                    <TextBlock Text="(graf eller nøgletal ...)" FontStyle="Italic"/>
                                </StackPanel>
                            </Border>
                        </UniformGrid>
                    </Grid>
                </TabItem>

                <!-- UDSTYR & MÅLINGER -->
                <TabItem Header="Energiforbug">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Topkontroller -->
                            <RowDefinition Height="*"/>
                            <!-- Tabel -->
                        </Grid.RowDefinitions>
                        <Button Content="Vælg Udstyr" Width="200" Height="20" Command="{Binding ShowEquipment}"></Button>
                        <!-- TOPLINJE MED KNAP + FILTER -->
                        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">


                            <!-- 🚀 Her er de TextBoxes du mangler -->
                            <StackPanel Orientation="Horizontal" Margin="10,0,0,0"/>
                        </StackPanel>



                        <!-- UDSTYRS-TABEL -->
                        <DataGrid Grid.Row="1"
          x:Name="EquipmentDataGrid"
          AutoGenerateColumns="False"
          IsReadOnly="True"
          ItemsSource="{Binding Equipments}"
          SelectedItem="{Binding SelectedEquipment, Mode=TwoWay}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Udstyr-ID" Binding="{Binding DeviceId}" Width="*"/>
                                <DataGridTextColumn Header="Navn/placering" Binding="{Binding ProductName}" Width="2*"/>
                                <DataGridTextColumn Header="Model" Binding="{Binding ParameterName}" Width="*"/>
                                <DataGridTextColumn Header="Forbundet?" Binding="{Binding ConnectionState}" Width="*"/>
                                <DataGridTextColumn Header="Forbrug" Binding="{Binding Value}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>

                    </Grid>
                </TabItem>

                <!-- KUNDER & TILKNYTNING -->
                <TabItem Header="Kundeliste">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/> <!-- Toplinje -->
                            <RowDefinition Height="2*"/> <!-- Kundetabel -->
                            <RowDefinition Height="2*"/> <!-- Udstyr til kunden -->
                            <RowDefinition Height="Auto"/> <!-- Kundens forbrug -->                         
                        </Grid.RowDefinitions>

                        <!-- TOPLINJE -->
                        <StackPanel Orientation="Horizontal" 
                                    Grid.Row="0" 
                                    Margin="0,0,0,10">
                        </StackPanel>


                        <!-- KUNDE-TABEL -->
                        <DataGrid Grid.Row="1"
          x:Name="CustomerDataGrid"
          AutoGenerateColumns="False"
          IsReadOnly="True"
          ItemsSource="{Binding Customers}"
          SelectedItem="{Binding SelectedCustomer, Mode=TwoWay}" >
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Udstyr-ID" Binding="{Binding ID}" Width="*"/>
                                <DataGridTextColumn Header="Navn" Binding="{Binding Name}" Width="2*"/>
                                <DataGridTextColumn Header="Adresse" Binding="{Binding Address}" Width="2*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        <!-- Udstyr som tilhører den valgte kunde -->
                        <GroupBox Grid.Row="2"
                                  Header="Udstyr til valgt kunde"
                                  Margin="0,10,0,0">
                            <DataGrid AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      ItemsSource="{Binding SelectedCustomer.CustomerEquipments}">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Udstyr-ID" Binding="{Binding DeviceId}"/>
                                    <DataGridTextColumn Header="Produktnavn" Binding="{Binding ProductName}"/>
                                    <DataGridTextColumn Header="Parameter" Binding="{Binding ParameterName}"/>
                                    <DataGridTextColumn Header="Værdi" Binding="{Binding Value}"/>
                                    <DataGridTextColumn Header="Periode" Binding="{Binding Timestamp}"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </GroupBox>
                        
                        <TextBlock Grid.Row="3"
                                   Margin="0,10,0,0"
                                   FontSize="16"
                                   FontWeight="Bold">
                                   <Run Text="Samlet forbrug: " />
                            <Run Text="{Binding SelectedCustomer.CustomerUsage}"/>
                            <Run Text=" kWh"/>
                        </TextBlock>

                    </Grid>
                </TabItem>

                <!-- AFREGNING & FAKTURA -->
                <TabItem Header="Afregning &amp; faktura" Height="20" VerticalAlignment="Top">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Overskrift -->
                            <RowDefinition Height="Auto"/>
                            <!-- Trin 1 + 2 -->
                            <RowDefinition Height="Auto"/>
                            <!-- Pris og beregning -->
                            <RowDefinition Height="*"/>
                            <!-- Faktura preview / ekstra plads -->
                        </Grid.RowDefinitions>

                        <!-- Overskrift -->
                        <TextBlock Grid.Row="0"
                                   Text="Afregning &amp; faktura"
                                   FontSize="20" FontWeight="Bold"
                                   Margin="0,0,0,10"/>

                        <!-- TRIN 1 + 2: Kunde, udstyr, periode -->
                        <GroupBox Grid.Row="1" Header="1. Vælg kunde, udstyr og periode" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <!-- Kunde -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="Kunde:" VerticalAlignment="Center" Width="80"/>
                                    <ComboBox x:Name="BillingCustomerComboBox"
              Width="250"
              ItemsSource="{Binding Customers}"
              DisplayMemberPath="Name"
              SelectedItem="{Binding BillingCustomer, Mode=TwoWay}" />
                                </StackPanel>

                                <!-- Udstyr -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="Udstyr:" VerticalAlignment="Center" Width="80"/>
                                    <ListBox x:Name="BillingEquipmentListBox" 
             Width="300" Height="80"
             ItemsSource="{Binding BillingEquipments}"
             DisplayMemberPath="ParameterName"
             SelectedItem="{Binding BillingEquipment, Mode=TwoWay}" />
                                </StackPanel>

                                <!-- Periode -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="Fra dato:" VerticalAlignment="Center" Width="80"/>
                                    <DatePicker x:Name="BillingFromDatePicker" Width="150" Margin="0,0,20,0" SelectedDate="{Binding FromDate}"/>

                                    <TextBlock Text="Til dato:" VerticalAlignment="Center" Width="80"/>
                                    <DatePicker x:Name="BillingToDatePicker" Width="150" SelectedDate="{Binding ToDate}"/>
                                    <Button Content="Hent målinger" Margin="20,0,0,0" Padding="10,5" Command="{Binding GetCalculations}"/>
                                </StackPanel>

                                <!-- Resultat af forbrug -->
                                <TextBlock x:Name="BillingConsumptionSummaryTextBlock"
                                           Text="Forbrug i perioden: (udregnes)"
                                           FontStyle="Italic"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- PRIS OG BEREGNING -->
                        <GroupBox Grid.Row="2" Header="2. Indtast elpris og beregn" Margin="0,0,0,10">
                            <StackPanel Margin="10">

                                <!-- Elpris 1 -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Width="220" VerticalAlignment="Center"
               Text="{Binding ModelName1, StringFormat={}{0} pris pr. kWh:}"/>
                                    <TextBox Width="80"
             Text="{Binding PricePerKwh1, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBlock Text="kr." VerticalAlignment="Center" Margin="5,0,0,0"/>
                                </StackPanel>

                                <!-- Elpris 2 -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Width="220" VerticalAlignment="Center"
               Text="{Binding ModelName2, StringFormat={}{0} pris pr. kWh:}"/>
                                    <TextBox Width="80"
             Text="{Binding PricePerKwh2, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBlock Text="kr." VerticalAlignment="Center" Margin="5,0,0,0"/>
                                </StackPanel>

                                <!-- Elpris 3 -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Width="220" VerticalAlignment="Center"
               Text="{Binding ModelName3, StringFormat={}{0} pris pr. kWh:}"/>
                                    <TextBox Width="80"
             Text="{Binding PricePerKwh3, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBlock Text="kr." VerticalAlignment="Center" Margin="5,0,0,0"/>
                                </StackPanel>


                                <!-- Moms -->
                                <!-- Moms -->
                                <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                                    <TextBlock Text="Moms-sats:" 
               Width="220"
               VerticalAlignment="Center"/>
                                    <TextBox x:Name="VatRateTextBox" IsReadOnly="True"
             Width="80"
             Text="25"/>
                                    <TextBlock Text="%" 
               VerticalAlignment="Center"
               Margin="5,0,0,0"/>
                                </StackPanel>


                                <!-- Resumé -->
                                <StackPanel>
                                    <TextBlock 
        Text="{Binding Subtotal, StringFormat='Energi-beløb ekskl. moms: {0:F2} kr'}"
        Margin="0,0,0,2"/>

                                    <TextBlock 
        Text="{Binding Subtotal, StringFormat='Subtotal ekskl. moms: {0:F2} kr'}"
        Margin="0,0,0,2"/>

                                    <TextBlock 
        Text="{Binding Vat, StringFormat='Moms: {0:F2} kr'}"
        Margin="0,0,0,2"/>

                                    <TextBlock 
        FontWeight="Bold"
        Text="{Binding Total, StringFormat='Total inkl. moms: {0:F2} kr'}"
        Margin="0,5,0,0"/>
                                </StackPanel>

                            </StackPanel>
                        </GroupBox>



                        <!-- FAKTURA-PREVIEW / HANDLING -->
                        <Grid Grid.Row="3">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Knapper -->
                            <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
                                <Button Content="Generér faktura" Width="140" Margin="0,0,10,0" Padding="10,5" Command="{Binding GenerateInvoice}"/>
                                <Button Content="Udskriv" Width="100" Margin="0,0,10,0" Padding="10,5" IsEnabled="False"/>
                                <Button Content="Download som PDF" Width="150" Margin="0,0,10,0" Padding="10,5" IsEnabled="False"/>
                            </StackPanel>

                            <!-- Simpelt faktura-preview (tekst) -->
                        </Grid>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</Window>